amends "@gha/Workflow.pkl"

on {
  workflow_run {
    workflows {
      import("build.pkl").name
      import("release.pkl").name
    }
    types {
      "completed"
    }
  }
}

jobs {
  ["test-results"] {
    name = "Test Results"
    `runs-on` = "ubuntu-latest"
    `if` = "github.event.workflow_run.conclusion == 'success' || github.event.workflow_run.conclusion == 'failure'"
    permissions {
      checks = "write"
      actions = "read"
    }
    steps {
      new {
        uses = "dorny/test-reporter@v2"
        with {
          ["artifact"] = "test-results"
          ["name"] = "Test Results"
          ["path"] = "**/*.xml"
        }
      }
    }
  }
}
