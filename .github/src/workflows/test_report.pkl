amends "@gha/Workflow.pkl"

import "@gha/actions/Artifact.pkl"

name = "PR Test Reports"

on {
  workflow_run {
    workflows {
      import("prb.pkl").name
    }
    types {
      "completed"
    }
  }
}

jobs {
  ["test-results"] {
    name = "Test Results"
    `runs-on` = "ubuntu-latest"
    `if` = "github.event.workflow_run.conclusion == 'success' || github.event.workflow_run.conclusion == 'failure'"
    permissions {
      checks = "write"
      actions = "read"
    }
    steps {
      new Artifact.Download {
        name = "Download artifacts"
        path = "test-results"
      }
      new {
        name = "Publish test results"
        uses = "EnricoMi/publish-unit-test-result-action@v2"
        with {
          ["files"] = "**/*.xml"
          ["comment"] = "off"
        }
      }
    }
  }
}
